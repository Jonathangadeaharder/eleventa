[pytest]
# Test discovery: find tests in any 'test_*.py' or '*_test.py' file.
python_files = test_*.py *_test.py

# Directories to search for tests.
testpaths = tests

# Directories to ignore during test collection
norecursedirs = .venv venv env .env node_modules .git .tox dist build

python_classes = Test* *Test *TestCase *Tests
python_functions = test_* *_test

# Core options
addopts = --cov=core --cov-report=html --cov-report=term
          -v

# Markers
markers =
    unit: Unit tests
    integration: Integration tests
    ui: UI tests requiring Qt
    smoke: Critical path smoke tests that should be stable
    alembic: Database migration tests
    timeout: set a custom timeout for a test or module

# Qt settings
qt_api = pyside6

# Logging
log_cli = true
log_cli_level = INFO

# Filter warnings
filterwarnings =

# For parallel execution, add this option when needed:
# -n auto

# Timeout settings - set higher timeout for UI tests to prevent false failures
timeout = 10.0
timeout_method = thread

# Set console output options
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s:%(filename)s:%(lineno)s - %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Common test commands (for documentation)
# pytest                  - Run all non-UI tests
# pytest --ui             - Run all tests including UI tests 
# pytest -m unit          - Run only unit tests
# pytest -m integration   - Run only integration tests
# pytest -m smoke         - Run only smoke tests (stable critical path tests)
# pytest tests/unit       - Run tests in the unit directory
# pytest -k "not ui"      - Explicitly exclude UI tests
# pytest -k ui -xvs       - Run UI tests with detailed output to debug issues

[coverage:run]
source =
    core
    ui
omit =
    tests/*
    venv/*

[coverage:report]
# Fail if coverage drops below 80%
#fail_under = 80
show_missing = True

# Add option for ui tests
# To run UI tests: pytest -k ui
