# Running Repository Tests Successfully\n\nThe repository tests in the infrastructure/persistence directory have been fixed to work properly with isolated database sessions.\n\n## Running the tests\n\nYou can run the tests in the following ways:\n\n### Option 1: Run each test separately (slower but more reliable)\n\n`\npython -m pytest tests/infrastructure/persistence/test_user_repository.py -v\npython -m pytest tests/infrastructure/persistence/test_department_repository.py -v\npython -m pytest tests/infrastructure/persistence/test_product_repository.py -v\npython -m pytest tests/infrastructure/persistence/test_sale_repository.py -v\npython -m pytest tests/infrastructure/persistence/test_invoice_repository.py -v\n`\n\n### Option 2: Run tests together in sequence\n\n`\npython -m pytest tests/infrastructure/persistence/test_user_repository.py tests/infrastructure/persistence/test_department_repository.py tests/infrastructure/persistence/test_product_repository.py tests/infrastructure/persistence/test_sale_repository.py tests/infrastructure/persistence/test_invoice_repository.py -v\n`\n\n### Note: Avoid running with directory pattern\n\nRunning with a directory pattern may cause SQLAlchemy session conflicts:\n\n`\n# May not work consistently:\npython -m pytest tests/infrastructure/persistence/ -v\n`\n\n## Explanation\n\nThe issue was related to how SQLAlchemy database sessions were being managed during tests. Each repository test file has a setup_database fixture that properly creates the tables it needs in an isolated in-memory SQLite database. When running multiple test files in the same pytest session with the directory pattern, there were issues with session management.
